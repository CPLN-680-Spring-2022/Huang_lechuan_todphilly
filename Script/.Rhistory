station_access$ID[station_access$ID %in% c("165", "210")] <- 165
#Pennsauken
station_access$ID[station_access$ID %in% c("186", "253")] <- 253
#Fern Rock
station_access$ID[station_access$ID %in% c("116", "307")] <- 307
#69th St
station_access$ID[station_access$ID %in% c("4", "201", "282")] <- 4
#8th St
station_access$ID[station_access$ID %in% c("231", "237", "296")] <- 296
#Center City (15, City Hall, Suburban)
station_access$ID[station_access$ID %in% c("297", "260", "314")] <- 314
#Norristown
station_access$ID[station_access$ID %in% c("144", "284")] <- 144
#Jefferson 11th
station_access$ID[station_access$ID %in% c("48", "221")] <- 221
station_access_clea <- aggregate(access ~ ID, station_access, sum)%>%
rename(sum_ac = access)
st_write(station_access_clea, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/station_access_0411.shp")
#add bus (determined by transportation center)
#Fern Rock 6, 69th 25, Norristown 10, Arrott 10, Olney 9m, Chester 9, Frankfort 25, Wissa 12.
station_access_clea$sum_ac[station_access_clea$ID %in% c("4")] <- 2255 + (25*50)
station_access_clea$sum_ac[station_access_clea$ID %in% c("87")] <- 49.5 + (12*50)
station_access_clea$sum_ac[station_access_clea$ID %in% c("144")] <- 329.5 + (10*50)
station_access_clea$sum_ac[station_access_clea$ID %in% c("195")] <- 1800 + (10*50)
station_access_clea$sum_ac[station_access_clea$ID %in% c("225")] <- 2400 + (9*50)
station_access_clea$sum_ac[station_access_clea$ID %in% c("255")] <- 49.5 + (9*50)
station_access_clea$sum_ac[station_access_clea$ID %in% c("272")] <- 1800 + (25*50)
station_access_clea$sum_ac[station_access_clea$ID %in% c("307")] <- 2785 + (6*50)
clean_station <- merge(x=station_access_clea,y=DVRPC_railstops,by="ID",all.x=TRUE)%>%
mutate(ac_score = ntile(sum_ac, 10))%>%
st_as_sf()%>%
st_transform(4326)
View(clean_station)
clean_station <- clean_station[, c("ID", "station", "line", "operator", "type_sym", "type",
"capacity", "freqe", "sum_ac", "ac_score")]
st_write(clean_station, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/station_access_0411.shp")
#job data
#see also: https://www.dvrpc.org/Reports/ADR021.pdf
jobs <- st_read("https://opendata.arcgis.com/datasets/0635910b84204020b1c8474a4732f257_0.geojson")%>%
mutate(job35den = emp35/Shape__Area,
job_sc = ntile(job30den, 10),
pop35den = pop35/Shape__Area,
jobsurp = emp35 - pop35,
surp_sc = ntile(jobsurp, 10))%>%
dplyr::select(objectid, co_name, mun_name, state, job_sc, emp35, pop35, job30den, pop35den, jobsurp, surp_sc, Shape__Area, geometry)%>%
st_transform(4326)
#job data
#see also: https://www.dvrpc.org/Reports/ADR021.pdf
jobs <- st_read("https://opendata.arcgis.com/datasets/0635910b84204020b1c8474a4732f257_0.geojson")%>%
mutate(job35den = emp35/Shape__Area,
job_sc = ntile(job35den, 10),
pop35den = pop35/Shape__Area,
jobsurp = emp35 - pop35,
surp_sc = ntile(jobsurp, 10))%>%
dplyr::select(objectid, co_name, mun_name, state, job_sc, emp35, pop35, job30den, pop35den, jobsurp, surp_sc, Shape__Area, geometry)%>%
st_transform(4326)
#job data
#see also: https://www.dvrpc.org/Reports/ADR021.pdf
jobs <- st_read("https://opendata.arcgis.com/datasets/0635910b84204020b1c8474a4732f257_0.geojson")%>%
mutate(job35den = emp35/Shape__Area,
job_sc = ntile(job35den, 10),
pop35den = pop35/Shape__Area,
jobsurp = emp35 - pop35,
surp_sc = ntile(jobsurp, 10))%>%
dplyr::select(objectid, co_name, mun_name, state, job_sc, emp35, pop35, job35den, pop35den, jobsurp, surp_sc, Shape__Area, geometry)%>%
st_transform(4326)
job_join <- jobs%>%
dplyr::select(job_sc, jobsurp, surp_sc)%>%
mutate(surp_abs = abs(jobsurp),
em_surp_sc = ntile(surp_abs, 10))%>%
dplyr::select(job_sc, surp_sc, em_surp_sc)
clean_station_job <- st_join(clean_station, job_join, join = st_within, left= TRUE)
View(clean_station_job)
clean_station_job <- st_join(clean_station, job_join, join = st_within, left= TRUE)%>%
dplyr::select(-"capacity", -"freqe", -"sum_ac", -"ac_score")
job_join2 <- jobs%>%
mutate(surp_abs = abs(jobsurp),
em_surp_sc = ntile(surp_abs, 10))
View(job_join2)
clean_station_job2 <- st_join(clean_station, job_join2, join = st_within, left= TRUE)%>%
dplyr::select(-"capacity", -"freqe", -"sum_ac", -"ac_score")
View(clean_station_job2)
clean_station_job <- st_join(clean_station, job_join, join = st_within, left= TRUE)
clean_station_job2 <- st_join(clean_station, job_join2, join = st_within, left= TRUE)%>%
dplyr::select(-objectid, co_name, mun_name, -"capacity", -"freqe", -"sum_ac", -"ac_score")
clean_station_job2 <- st_join(clean_station, job_join2, join = st_within, left= TRUE)%>%
dplyr::select(-objectid, -state, -"capacity", -"freqe", -"sum_ac", -"ac_score")
clean_station_job2 <- clean_station_job2[, c("ID", "station", "line", "operator", "type_sym", "type",
"job35", "job_sc", "job35den", "pop35", "pop35den",
"job_surp", "surp_abs", "em_surp_sc",
"geometry")]
clean_station_job2 <- clean_station_job2[, c("ID", "station", "line", "operator", "type_sym", "type",
"emp35", "job_sc", "job35den", "pop35", "pop35den",
"job_surp", "surp_abs", "em_surp_sc",
"geometry")]
clean_station_job2 <- st_join(clean_station, job_join2, join = st_within, left= TRUE)%>%
dplyr::select(-objectid, -state, -"capacity", -"freqe", -"sum_ac", -"ac_score",
-surp_sc, -Shape__Area)
clean_station_job2 <- clean_station_job2[, c("ID", "station", "line", "operator", "type_sym", "type",
"emp35", "job_sc", "job35den", "pop35", "pop35den",
"job_surp", "surp_abs", "em_surp_sc",
"geometry")]
clean_station_job2 <- clean_station_job2[, c("ID", "station", "line", "operator", "type_sym", "type",
"co_name", "mun_name",
"emp35", "job_sc", "job35den", "pop35", "pop35den",
"job_surp", "surp_abs", "em_surp_sc",
"geometry")]
clean_station_job2 <- clean_station_job2[, c("ID", "station", "line", "operator", "type_sym", "type",
"co_name", "mun_name",
"emp35", "job_sc", "job35den", "pop35", "pop35den",
"jobsurp", "surp_abs", "em_surp_sc",
"geometry")]
st_write(clean_station_job2, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/station_job_0411.shp")
social <- Study.sf%>%
dplyr::select(NAME, TotalPp, TotalHH, MedIncm, Pvrty_r, rt_hwng)%>%
mutate(pvt_rate = Pvrty_r/TotalPp,
pvt_qn = ntile(-pvt_rate, 10),
MdInm_qn = ntile(MedIncm, 10),
aff_gp = abs(pvt_qn - MdInm_qn),
gp_score = ntile(aff_gp, 10),
ownh_rate = rt_hwng/TotalPp,
own_hs_qn = ntile(-ownh_rate, 10))%>%
st_transform(4326)#higher the score, the lower the rate
station_social <- st_join(clean_station_job, social, join = st_within, left= TRUE)
View(station_social)
station_social <- st_join(clean_station_job, social, join = st_within, left= TRUE)%>%
dplyr::select(-"capacity", -"freqe", -"sum_ac", -"ac_score")
station_social <- st_join(clean_station_job, social, join = st_within, left= TRUE)
station_social1 <- st_join(clean_station_job, social, join = st_within, left= TRUE)%>%
dplyr::select(-"capacity", -"freqe", -"sum_ac", -"ac_score")
station_social_final <- station_social%>%
dplyr::select(-NAME, -TotalPp, -TotalHH, -rt_hwng, -ownh_rate)%>%
mutate(not_gen = ntile(gp_score/own_hs_qn, 10))%>%
dplyr::select(-MedIncm, -Pvrty_r, -pvt_rate, -aff_gp, -gp_score, -own_hs_qn)
View(station_social_final)
gentrification <- filter(station_social, MedIncm<25000 & MedIncm>10000)%>% #outlier of college town
dplyr::select(station, line, MedIncm, MdInm_qn, pvt_rate, pvt_qn, gp_score)%>%
arrange(desc(gp_score/own_hs_qn))
gentrification <- filter(station_social, MedIncm<25000 & MedIncm>10000)%>% #outlier of college town
dplyr::select(station, line, MedIncm, MdInm_qn, pvt_rate, pvt_qn, gp_score, own_hs_qn)%>%
arrange(desc(gp_score/own_hs_qn))
View(gentrification)
source("~/GitHub/Huang_lechuan_todphilly/Script/Clean_0407.R", echo=TRUE)
gentrification <- filter(station_social, MedIncm<25000 & MedIncm>10000)%>% #outlier of college town
dplyr::select(station, line, MedIncm, MdInm_qn, pvt_rate, pvt_qn, gp_score, own_hs_qn)%>%
mutate(not_gen = ntile(gp_score/own_hs_qn, 10))%>%
arrange(desc(not_gen))
gentrification <- filter(station_social, MedIncm<25000 & MedIncm>10000)%>% #outlier of college town
dplyr::select(station, line, MedIncm, MdInm_qn, pvt_rate, pvt_qn, gp_score, own_hs_qn)%>%
mutate(not_gen = ntile(gp_score/own_hs_qn, 10))%>%
arrange(asc(not_gen))
gentrification <- filter(station_social_final, MedIncm<25000 & MedIncm>10000)%>% #outlier of college town
dplyr::select(station, line, MedIncm, MdInm_qn, pvt_rate, pvt_qn, gp_score, own_hs_qn)%>%
arrange(not_gen)
gentrification <- filter(station_social, MedIncm<25000 & MedIncm>10000)%>% #outlier of college town
dplyr::select(station, line, MedIncm, MdInm_qn, pvt_rate, pvt_qn, gp_score, own_hs_qn)%>%
mutate(not_gen = ntile(gp_score/own_hs_qn, 10))%>%
arrange(not_gen)
st_write(gentrification, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/gentrification_stations.shp")
write_csv(gentrification, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/gentrification_stations.csv")
station_final <- station_social_final
locality <- st_read("https://opendata.arcgis.com/datasets/0af75c94e931476ba0abec18f369875c_0.geojson")%>%
st_transform(4326)%>%
filter(dvrpc_reg == "Yes")
loc <- locality%>%
dplyr::select(mun_type, acres, geometry)
station_loc <- st_join(station_final, loc, join = st_within, left= TRUE)%>%
mutate(loc_sc = ifelse(mun_type == "City", 10,
ifelse(mun_type == "Borough", 8,
ntile(-acres, 7))))%>%
dplyr::select(-mun_type, -acres)
station_l2 <- station_loc[, c("ID", "station", "line", "operator", "type_sym", "type",
"sum_ac", "ac_score", "job_sc", "surp_sc", "em_surp_sc",
"pvt_qn", "MdInm_qn", "not_gen", "loc_sc",
"geometry")]
View(station_l2)
st_write(station_l2, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/stations_access_jobs_census_loc_0411.shp")
station_l2 <- station_loc[, c("ID", "station", "line", "operator", "type_sym", "type",
"ac_score", "job_sc", "surp_sc", "em_surp_sc",
"pvt_qn", "MdInm_qn", "not_gen", "loc_sc",
"geometry")]
st_write(station_l2, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/stations_access_jobs_census_loc_0411.shp")
ggplot() +
geom_sf(data=st_union(Study.sf)) +
geom_sf(data=station_l2, aes(colour = not_gen),
show.legend = "point", size = 5) +
labs(title="DVRPC's analysis of Station area",
subtitle="Station by likelyhood of being gentrified",
caption="Figure xx") +
mapTheme()
View(station_l2)
View(station_access_clea)
View(station_loc)
station_l2$ac_score[station_l2$ac_score < 5] <- 1
st_write(station_l2, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/stations_access_jobs_census_loc_0411.shp")
clean_station <- st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/station_access_0411.shp")
library(tidycensus)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(rgdal)
library(sf)
library(raster)
root.dir = "https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/DATA/"
source("https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/functions.r")
census_api_key("3050a770b2aedfa128dd2ccc6ca8b8524fccc775", overwrite = TRUE)
palette5 <- c("#25CB10", "#5AB60C", "#8FA108",   "#C48C04", "#FA7800")
clean_station <- st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/station_access_0411.shp")
final_station <- st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/stations_access_jobs_census_loc_0411.shp")
View(clean_station)
station_new <- clean_station%>%
replace(ac_score = split(clean_station, cut(clean_station$sum_ac, 10)))
station_new <- clean_station%>%
mutate(ac_score = split(clean_station, cut(clean_station$sum_ac, 10)))
station_new <- clean_station%>%
mutate(ac_score = cut(clean_station$sum_ac, 10))
View(clean_station)
View(station_new)
station_new <- clean_station%>%
mutate(ac_score = as.numeric(cut(clean_station$sum_ac, 10)))
View(final_station)
final_station2 <- final_station%>%
dplyr::select(-ac_score)
station_l2 <- merge(x=final_station2,y=station_new,by="ID",all.x=TRUE)
final_station2 <- final_station%>%
dplyr::select(-ac_score)%>%
st_transform(4326)
station_l2 <- merge(x=final_station2,y=station_new,by="ID",all.x=TRUE)
station_new <- clean_station%>%
mutate(ac_score = as.numeric(cut(clean_station$sum_ac, 10)))%>%
st_transform(4326)
station_l2 <- merge(x=final_station2,y=station_new,by="ID",all.x=TRUE)
station_l2 <- merge(x=final_station2,y=station_new,by="ID",all.x=TRUE)%>%
st_as_sf()%>%
st_transform(4326)
station_new <- clean_station%>%
mutate(ac_score = as.numeric(cut(clean_station$sum_ac, 10)))%>%
as.data.frame()
station_l2 <- merge(x=final_station2,y=station_new,by="ID",all.x=TRUE)%>%
st_as_sf()%>%
st_transform(4326)
station_new <- clean_station%>%
mutate(ac_score = as.numeric(cut(clean_station$sum_ac, 10)))%>%
dplyr::select(-geometry)
station_l2 <- merge(x=final_station2,y=station_new,by="ID",all.x=TRUE)%>%
st_as_sf()%>%
st_transform(4326)
station_new <- clean_station%>%
mutate(ac_score = as.numeric(cut(clean_station$sum_ac, 10)))%>%
st_drop_geometry()
station_l2 <- merge(x=final_station2,y=station_new,by="ID",all.x=TRUE)%>%
st_as_sf()%>%
st_transform(4326)
View(station_l2)
clean_station <- clean_station[, c("ID", "station", "line", "operator", "type_sym", "type",
"capacity", "freqe", "sum_ac", "ac_score")]
st_write(clean_station, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/station_access_0412.shp")
#job data
#see also: https://www.dvrpc.org/Reports/ADR021.pdf
jobs <- st_read("https://opendata.arcgis.com/datasets/0635910b84204020b1c8474a4732f257_0.geojson")%>%
mutate(job35den = emp35/Shape__Area,
job_sc = ntile(job35den, 10),
pop35den = pop35/Shape__Area,
jobsurp = emp35 - pop35,
surp_sc = ntile(jobsurp, 10))%>%
dplyr::select(objectid, co_name, mun_name, state, job_sc, emp35, pop35, job35den, pop35den, jobsurp, surp_sc, Shape__Area, geometry)%>%
st_transform(4326)
job_join <- jobs%>%
dplyr::select(job_sc, jobsurp, surp_sc)%>%
mutate(surp_abs = abs(jobsurp),
em_surp_sc = ntile(surp_abs, 10))%>%
dplyr::select(job_sc, surp_sc, em_surp_sc)
job_join2 <- jobs%>%
mutate(surp_abs = abs(jobsurp),
em_surp_sc = ntile(surp_abs, 10))
clean_station_job <- st_join(clean_station, job_join, join = st_within, left= TRUE)
clean_station_job2 <- st_join(clean_station, job_join2, join = st_within, left= TRUE)%>%
dplyr::select(-objectid, -state, -"capacity", -"freqe", -"sum_ac", -"ac_score",
-surp_sc, -Shape__Area)
clean_station_job2 <- clean_station_job2[, c("ID", "station", "line", "operator", "type_sym", "type",
"co_name", "mun_name",
"emp35", "job_sc", "job35den", "pop35", "pop35den",
"jobsurp", "surp_abs", "em_surp_sc",
"geometry")]
st_write(clean_station_job2, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/station_job_0412.shp")
social <- Study.sf%>%
dplyr::select(NAME, TotalPp, TotalHH, MedIncm, Pvrty_r, rt_hwng)%>%
mutate(pvt_rate = Pvrty_r/TotalPp,
pvt_qn = ntile(-pvt_rate, 10),
MdInm_qn = ntile(MedIncm, 10),
aff_gp = abs(pvt_qn - MdInm_qn),
gp_score = ntile(aff_gp, 10),
ownh_rate = rt_hwng/TotalPp,
own_hs_qn = ntile(-ownh_rate, 10))%>%
st_transform(4326)#higher the score, the lower the rate
Study.sf <- st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/Tract_map_TOD_0208.shp")
social <- Study.sf%>%
dplyr::select(NAME, TotalPp, TotalHH, MedIncm, Pvrty_r, rt_hwng)%>%
mutate(pvt_rate = Pvrty_r/TotalPp,
pvt_qn = ntile(-pvt_rate, 10),
MdInm_qn = ntile(MedIncm, 10),
aff_gp = abs(pvt_qn - MdInm_qn),
gp_score = ntile(aff_gp, 10),
ownh_rate = rt_hwng/TotalPp,
own_hs_qn = ntile(-ownh_rate, 10))%>%
st_transform(4326)#higher the score, the lower the rate
station_social <- st_join(clean_station_job, social, join = st_within, left= TRUE)
station_social1 <- st_join(clean_station_job, social, join = st_within, left= TRUE)%>%
dplyr::select(-"capacity", -"freqe", -"sum_ac", -"ac_score")
station_social_final <- station_social%>%
dplyr::select(-NAME, -TotalPp, -TotalHH, -rt_hwng, -ownh_rate)%>%
mutate(not_gen = ntile(gp_score/own_hs_qn, 10))%>%
dplyr::select(-MedIncm, -Pvrty_r, -pvt_rate, -aff_gp, -gp_score, -own_hs_qn)
st_write(station_social_final, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/stations_jobs_census_0412.shp")
locality <- st_read("https://opendata.arcgis.com/datasets/0af75c94e931476ba0abec18f369875c_0.geojson")%>%
st_transform(4326)%>%
filter(dvrpc_reg == "Yes")
loc <- locality%>%
dplyr::select(mun_type, acres, geometry)
station_loc <- st_join(station_final, loc, join = st_within, left= TRUE)%>%
mutate(loc_sc = ifelse(mun_type == "City", 10,
ifelse(mun_type == "Borough", 8,
ntile(-acres, 7))))%>%
dplyr::select(-mun_type, -acres)
station_final <- st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/stations_access_jobs_census_0412.shp")
station_final <- st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/stations_jobs_census_0412.shp")
station_loc <- st_join(station_final, loc, join = st_within, left= TRUE)%>%
mutate(loc_sc = ifelse(mun_type == "City", 10,
ifelse(mun_type == "Borough", 8,
ntile(-acres, 7))))%>%
dplyr::select(-mun_type, -acres)
station_l2 <- station_loc[, c("ID", "station", "line", "operator", "type_sym", "type",
"ac_score", "job_sc", "surp_sc", "em_surp_sc",
"pvt_qn", "MdInm_qn", "not_gen", "loc_sc",
"geometry")]
st_write(station_l2, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/stations_access_jobs_census_loc_0412.shp")
final <- st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/stations_access_jobs_census_loc_0412.shp")
slopep <- st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/raw_data/DEM/slopepp.shp")
station_sl <- st_join(final, st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/raw_data/DEM/slopepp.shp"), join = st_nearest_points, left= TRUE)
slopep <- st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/raw_data/DEM/slo_select.shp")
slopep <- st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/raw_data/DEM/slo_select.shp")
View(slopep)
station_sl <- st_join(final, slopep, join = st_nearest_points, left= TRUE)
station_sl <- st_join(final, slopep, join = st_nearest_points, left= TRUE)
station_sl <- st_join(final, slopep, join = st_nearest_feature, left= TRUE)
View(station_sl)
station_sl <- st_join(final, slopep, join = st_nearest_feature, left= TRUE)%>%
dplyr::select(-pointid)%>%
rename(slope = gridcode)
station_sl <- st_join(final, slopep, join = st_nearest_feature, left= TRUE)%>%
dplyr::select(-pointid)%>%
rename(slope = grid_code)
View(station_sl)
station_slp <- station_sl%>%
dplyr::select("ID", "station", "line", "operator", "type_sym", "type", slope)
View(station_slp)
clope <- st_join(slopep, final, join = st_contains)
View(clope)
clope <- st_join(slopep, final, join = st_contains, left=TRUE)
clope <- st_join(final, slopep, join = st_within(100), left=TRUE)
clope <- st_join(final, slopep, join = st_within, left=TRUE)
View(clope)
clope <- st_join(final, slopep, join = st_is_within_distance(100), left=TRUE)
clope <- st_join(final, slopep, join = st_is_within_distance, left=TRUE)
station.buffer <- st_buffer(final, 100)
clope <- st_join(slopep, station.buffer, join = st_within, left=TRUE)
View(clope)
clo.group <- clope%>%
group_by(ID)%>%
summarise(slope = mean(grid_code))
View(clo.group)
View(station_slp)
View(station_sl)
station_sl$slope[station_sl$loc_sc %in% == 10] <- 0
station_sl$slope[station_sl$loc_sc %in% = 10] <- 0
station_sl$slope[station_sl$loc_sc = 10] <- 0
station_sl$slope[station_sl$loc_sc == 10] <- 0
station_sl <- st_join(final, slopep, join = st_nearest_feature, left= TRUE)%>%
dplyr::select(-pointid)%>%
rename(slope = grid_code)
#clean center city
station_sl$slope[station_sl$ID %in% c("314", "219", "200", "175", "37", "221")] <- 0
station_slp <- station_sl%>%
dplyr::select("ID", "station", "line", "operator", "type_sym", "type", slope)
View(station_slp)
station_sl <- station_sl%>%
mutate(slo_sc = as.numeric(cut(station_sl$slope, 10)))
station_slp <- station_sl%>%
dplyr::select("ID", "station", "line", "operator", "type_sym", "type", slope, slo_sc, geometry)
View(station_slp)
station_sl2 <- station_sl[, c("ID", "station", "line", "operator", "type_sym", "type",
"ac_score", "job_sc", "surp_sc", "em_surp_sc",
"pvt_qn", "MdInm_qn", "not_gen", "loc_sc", "slo_sc"
"geometry")]
station_sl2 <- station_sl[, c("ID", "station", "line", "operator", "type_sym", "type",
"ac_score", "job_sc", "surp_sc", "em_surp_sc",
"pvt_qn", "MdInm_qn", "not_gen", "loc_sc", "slo_sc",
"geometry")]
View(station_sl2)
st_write(station_sl2, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/stations_access_jobs_census_loc_slope_0412.shp")
st_write(station_slp, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/stations_slope.shp")
ggplot() +
geom_sf(data=st_union(Study.sf)) +
geom_sf(data=station_sl2, aes(colour = slo_sc),
show.legend = "point", size = 5) +
labs(title="DVRPC's analysis of Station area",
subtitle="Station by likelyhood of being gentrified",
caption="Figure xx") +
mapTheme()
ggplot() +
geom_sf(data=st_union(Study.sf)) +
geom_sf(data=station_sl2, aes(colour = slo_sc),
show.legend = "point", size = 5) +
labs(title="DVRPC's analysis of Station area",
subtitle="Station by slope",
caption="Figure xx") +
mapTheme()
station_sl <- station_sl%>%
mutate(slo_sc = as.numeric(cut(-station_sl$slope, 10)))
station_slp <- station_sl%>%
dplyr::select("ID", "station", "line", "operator", "type_sym", "type", slope, slo_sc, geometry)
View(station_slp)
station_sl2 <- station_sl[, c("ID", "station", "line", "operator", "type_sym", "type",
"ac_score", "job_sc", "surp_sc", "em_surp_sc",
"pvt_qn", "MdInm_qn", "not_gen", "loc_sc", "slo_sc",
"geometry")]
st_write(station_sl2, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/stations_access_jobs_census_loc_slope_0412.shp")
st_write(station_slp, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/stations_slope.shp")
ggplot() +
geom_sf(data=st_union(Study.sf)) +
geom_sf(data=station_sl2, aes(colour = slo_sc),
show.legend = "point", size = 5) +
labs(title="DVRPC's analysis of Station area",
subtitle="Station by slope",
caption="Figure xx") +
mapTheme()
library(tidycensus)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(rgdal)
library(sf)
library(raster)
diff <- st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/Predict_DVRPC_diff.shp")
Study.sf <- st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/Tract_map_TOD_0208.shp")
root.dir = "https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/DATA/"
source("https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/functions.r")
census_api_key("3050a770b2aedfa128dd2ccc6ca8b8524fccc775", overwrite = TRUE)
palette5 <- c("#25CB10", "#5AB60C", "#8FA108",   "#C48C04", "#FA7800")
View(diff)
ggplot() +
geom_sf(data=st_union(Study.sf)) +
geom_sf(data=diff, aes(colour = diff_ep),
show.legend = "point", size = 3) +
labs(title="DVRPC's analysis of Station area",
subtitle="Existing large parcels around the station",
caption="Figure xx") +
mapTheme()
ggplot() +
geom_sf(data=st_union(Study.sf)) +
geom_sf(data=diff, aes(colour = diff_ep),
show.legend = "point", size = 3) +
labs(title="Prediction Difference",
subtitle="My Prediction - DVRPC's Prediction",
caption="Figure xx") +
mapTheme()
test <- st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/TOD_stationlist_0414.shp")
#DVRPC Comparison
DVRPC_TOD <- st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/raw_data/DVRPC_TOD/TOD_Opportunities.shp")%>%
st_transform(4326)%>%
dplyr::select(STATION, LINE, ExistingOr, FuturePote)
test_clean <- test%>%
dplyr::select(-"operator", -"type_sym", -"type",
-"ac_score", -"job_sc", -"em_surp_sc",
-"pvt_qn", -"MdInm_qn", -"not_gen", -"loc_sc", -"slo_sc",
-"duti_sc", -"attr_sc", -"unattr_sc")
rate_dif <- st_join(test_clean, DVRPC_TOD, join = st_nearest_feature)
rate_dif <- rate_dif%>%
mutate(aph_b2 = sc_aph/2,
diff = aph_b2 - FuturePote,
diff_ep = ifelse(ExistingOr > FuturePote, aph_b2 - ExistingOr,
aph_b2 - FuturePote))
rate_diff <- rate_dif[, c("ID", "station", "line", "ExistingOr", "FuturePote",
"aph_b2", "diff", "diff_ep",
"geometry")]
rate_dif <- st_join(DVRPC_TOD, test_clean, join = st_nearest_feature)
rate_dif <- rate_dif%>%
mutate(aph_b2 = sc_aph/2,
diff = aph_b2 - FuturePote,
diff_ep = ifelse(ExistingOr > FuturePote, aph_b2 - ExistingOr,
aph_b2 - FuturePote))
rate_diff <- rate_dif[, c("ID", "station", "line", "ExistingOr", "FuturePote",
"aph_b2", "diff", "diff_ep",
"geometry")]
st_write(rate_diff, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/Predict_DVRPC_diff.shp")
ggplot() +
geom_sf(data=st_union(Study.sf)) +
geom_sf(data=diff, aes(colour = diff_ep),
show.legend = "point", size = 3) +
labs(title="Prediction Difference",
subtitle="My Prediction - DVRPC's Prediction",
caption="Figure xx") +
mapTheme()
ggplot() +
geom_sf(data=st_union(Study.sf)) +
geom_sf(data=rate_diff, aes(colour = diff_ep),
show.legend = "point", size = 3) +
labs(title="Prediction Difference",
subtitle="My Prediction - DVRPC's Prediction",
caption="Figure xx") +
mapTheme()
View(rate_diff)
