library(tidycensus)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(rgdal)
library(sf)
library(raster)
root.dir = "https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/DATA/"
source("https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/functions.r")
census_api_key("3050a770b2aedfa128dd2ccc6ca8b8524fccc775", overwrite = TRUE)
palette5 <- c("#25CB10", "#5AB60C", "#8FA108",   "#C48C04", "#FA7800")
station_final <- sf_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/stations_access_jobs_census.shp")
station_final <- st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/stations_access_jobs_census.shp")
locality <- st_read("https://opendata.arcgis.com/datasets/0af75c94e931476ba0abec18f369875c_0.geojson")%>%
st_transform(4326)%>%
filter(dvrpc_reg == "Yes")
View(locality)
summary(as.factor(locality$mun_type))
summary(locality$st_area(shape)[mun_type=="Borough"])
summary(locality$st_area(shape))
summary("locality$st_area(shape)")
summarise("locality$st_area(shape)")
summarise(as.numeric("locality$st_area(shape)"))
summary(as.numeric("locality$st_area(shape)"))
mean(as.numeric("locality$st_area(shape)"))
locality <- locality%>%
rename(shape_ar = st_area(shape))
locality <- locality%>%
rename(shape_ar = 'st_area(shape)')
View(locality)
summary(as.numeric(Shape__Area))
summary(as.numeric(locality$Shape__Area))
summary(as.numeric(locality$Shape__Area[mun_type =="Borough"]))
summary(as.numeric(locality$Shape__Area[locality$mun_type =="Borough"]))
summary(as.numeric(locality$Shape__Area[locality$mun_type =="Borough"]))
summary(as.numeric(locality$Shape__Area[locality$mun_type =="Township"]))
summary(as.numeric(locality$Shape__Area[locality$mun_type =="City"]))
View(locality)
summary(as.numeric(locality$acres[locality$mun_type =="Borough"]))
summary(as.numeric(locality$acres[locality$mun_type =="Township"]))
summary(as.numeric(locality$acres[locality$mun_type =="City"]))
loc <- locality%>%
select(mun_type, geometry)
loc <- locality%>%
dplyr::select(mun_type, geometry)
station_loc <- st_join(station_final, loc, join = st_within, left= TRUE)
View(station_loc)
loc <- locality%>%
dplyr::select(mun_type, acres, geometry)
station_loc <- st_join(station_final, loc, join = st_within, left= TRUE)
View(station_loc)
summary(as.numeric(station_loc$acres[station_loc$mun_type =="Borough"]))
summary(as.numeric(station_loc$acres[station_loc$mun_type =="Township"]))
summary(as.numeric(station_loc$acres[station_loc$mun_type =="City"]))
View(station_loc)
View(locality)
loc <- locality%>%
dplyr::select(mun_type, acres, mun_name, geometry)
station_loc <- st_join(station_final, loc, join = st_within, left= TRUE)
loc <- locality%>%
dplyr::select(mun_type, acres, geometry)
station_loc <- st_join(station_final, loc, join = st_within, left= TRUE)%>%
mutate(loc_sc = ifelse(mun_type == "City", 10,
ifelse(mun_type = "Borough", 8,
ntile(-acres, 7))))
View(station_loc)
station_loc <- st_join(station_final, loc, join = st_within, left= TRUE)
station_loc <- station_loc%>%
mutate(loc_sc = ifelse(mun_type == "City", 10,
ifelse(mun_type = "Borough", 8,
ntile(-acres, 7))))
station_loc <- station_loc%>%
mutate(loc_sc = ifelse(mun_type == "City", 10,
ifelse(mun_type == "Borough", 8,
ntile(-acres, 7))))
View(station_loc)
station_loc <- st_join(station_final, loc, join = st_within, left= TRUE)%>%
mutate(loc_sc = ifelse(mun_type == "City", 10,
ifelse(mun_type == "Borough", 8,
ntile(-acres, 7))))%>%
dplyr::select(-mun_type, -acres)
View(station_loc)
ls(station_loc)
station_loc <- st_join(station_final, loc, join = st_within, left= TRUE)%>%
mutate(loc_sc = ifelse(mun_type == "City", 10,
ifelse(mun_type == "Borough", 8,
ntile(-acres, 7))))%>%
dplyr::select(ID, station, line, operator, type_sym, type,
sum_ac, ac_score, job_sc, job_surp, em_surp_sc,
pvt_qn, MdInm_qn, not_gen, Loc_sc,
geometry)
station_loc <- st_join(station_final, loc, join = st_within, left= TRUE)%>%
mutate(loc_sc = ifelse(mun_type == "City", 10,
ifelse(mun_type == "Borough", 8,
ntile(-acres, 7))))%>%
dplyr::select(ID, station, line, operator, type_sym, type,
sum_ac, ac_score, job_sc, surp_sc, em_surp_sc,
pvt_qn, MdInm_qn, not_gen, Loc_sc,
geometry)
station_loc <- st_join(station_final, loc, join = st_within, left= TRUE)%>%
mutate(loc_sc = ifelse(mun_type == "City", 10,
ifelse(mun_type == "Borough", 8,
ntile(-acres, 7))))%>%
dplyr::arrange(ID, station, line, operator, type_sym, type,
sum_ac, ac_score, job_sc, surp_sc, em_surp_sc,
pvt_qn, MdInm_qn, not_gen, Loc_sc,
geometry)
station_loc <- st_join(station_final, loc, join = st_within, left= TRUE)%>%
mutate(loc_sc = ifelse(mun_type == "City", 10,
ifelse(mun_type == "Borough", 8,
ntile(-acres, 7))))%>%
dplyr::arrange(ID, station, line, operator, type_sym, type,
sum_ac, ac_score, job_sc, surp_sc, em_surp_sc,
pvt_qn, MdInm_qn, not_gen, loc_sc,
geometry)
station_loc <- st_join(station_final, loc, join = st_within, left= TRUE)%>%
mutate(loc_sc = ifelse(mun_type == "City", 10,
ifelse(mun_type == "Borough", 8,
ntile(-acres, 7))))%>%
dplyr::select(-mun_type, -acres)%>%
dplyr::arrange(ID, station, line, operator, type_sym, type,
sum_ac, ac_score, job_sc, surp_sc, em_surp_sc,
pvt_qn, MdInm_qn, not_gen, loc_sc,
geometry)
station_loc <- st_join(station_final, loc, join = st_within, left= TRUE)%>%
mutate(loc_sc = ifelse(mun_type == "City", 10,
ifelse(mun_type == "Borough", 8,
ntile(-acres, 7))))%>%
dplyr::select(-mun_type, -acres)%>%
arrange(ID, station, line, operator, type_sym, type,
sum_ac, ac_score, job_sc, surp_sc, em_surp_sc,
pvt_qn, MdInm_qn, not_gen, loc_sc,
geometry)
station_loc <- st_join(station_final, loc, join = st_within, left= TRUE)%>%
mutate(loc_sc = ifelse(mun_type == "City", 10,
ifelse(mun_type == "Borough", 8,
ntile(-acres, 7))))%>%
dplyr::select(-mun_type, -acres)
"geometry")
station_loc <- st_join(station_final, loc, join = st_within, left= TRUE)%>%
mutate(loc_sc = ifelse(mun_type == "City", 10,
ifelse(mun_type == "Borough", 8,
ntile(-acres, 7))))%>%
dplyr::select(-mun_type, -acres)%>%
station_l2 <- station_loc[, c("ID", "station", "line", "operator", "type_sym", "type",
"sum_ac", "ac_score", "job_sc", "surp_sc", "em_surp_sc",
"pvt_qn", "MdInm_qn", "not_gen", "loc_sc",
"geometry")]
station_l2 <- station_loc[, c("ID", "station", "line", "operator", "type_sym", "type",
"sum_ac", "ac_score", "job_sc", "surp_sc", "em_surp_sc",
"pvt_qn", "MdInm_qn", "not_gen", "loc_sc",
"geometry")]
View(station_l2)
st_write(station_l2, "C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/0410_stations_access_jobs_census_loc.shp")
View(station_l2)
Study.sf <- st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/Tract_map_TOD_0208.shp")
ggplot() +
geom_sf(data=st_union(Study.sf)) +
geom_sf(data=station_l2, aes(colour = loc_sc),
show.legend = "point", size = 5) +
labs(title="DVRPC's analysis of Station area",
subtitle="Station with low-affordability gaps around",
caption="Figure xx") +
mapTheme()
ggplot() +
geom_sf(data=st_union(Study.sf)) +
geom_sf(data=station_l2, aes(colour = loc_sc),
show.legend = "point", size = 5) +
labs(title="DVRPC's analysis of Station area",
subtitle="Station by municipality level it is located",
caption="Figure xx") +
mapTheme()
library(tidycensus)
library(ggplot2)
library(tidyverse)
library(dplyr)
library(rgdal)
library(sf)
library(raster)
root.dir = "https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/DATA/"
source("https://raw.githubusercontent.com/urbanSpatial/Public-Policy-Analytics-Landing/master/functions.r")
census_api_key("3050a770b2aedfa128dd2ccc6ca8b8524fccc775", overwrite = TRUE)
palette5 <- c("#25CB10", "#5AB60C", "#8FA108",   "#C48C04", "#FA7800")
station_final <- st_read("C:/Users/mnxan/OneDrive/Documents/GitHub/Huang_lechuan_todphilly/cleaned_data/final_mat/0410_stations_access_jobs_census_loc.shp")
View(station_final)
